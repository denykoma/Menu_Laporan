<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Data Operator SDP — Sulawesi Selatan</title>
  <style>
    :root{--bg:#f7f9fc;--card:#fff;--accent:#0f62fe;--muted:#6b7280}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:32px auto;padding:20px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(12,18,34,.06)}
    header h1{margin:0;font-size:22px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    select,input{padding:8px 10px;border-radius:8px;border:1px solid #e6e9ef}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{padding:10px;text-align:left;border-bottom:1px solid #eef2f7;font-size:14px}
    th{background:linear-gradient(0deg,#fbfdff,#fbfdff);font-weight:600;color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}
    .actions button{margin-right:6px;background:#eef2ff;color:#0639a6;padding:6px 8px;border-radius:6px}
    .small{font-size:13px;padding:6px 8px}
    .flex{display:flex;align-items:center;gap:8px}
    .right{margin-left:auto}
    .note{margin-top:12px;color:var(--muted);font-size:13px}
    @media (max-width:760px){table,thead,tbody,tr,th,td{display:block}th{display:none}td{border-bottom:1px solid #eee;padding:10px 8px}td:before{content:attr(data-label);font-weight:600;display:block;margin-bottom:6px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>Data Operator — Provinsi Sulawesi Selatan</h1>
        <div class="note">Template untuk menyimpan & mengelola data operator per kabupaten/kota. Disimpan di <strong>localStorage</strong>. Kamu bisa impor/ekspor CSV.</div>
      </header>

      <div class="controls">
        <select id="regionFilter">
          <option value="">— Semua Kabupaten/Kota —</option>
          <!-- Contoh wilayah. Ganti/isi sesuai kebutuhan -->
          <option>Makassar</option>
          <option>Parepare</option>
          <option>Palopo</option>
          <option>Bone</option>
          <option>Bulukumba</option>
          <option>Gowa</option>
          <option>Pinrang</option>
          <option>Soppeng</option>
          <option>Takalar</option>
          <option>Maros</option>
          <option>... (tambahkan lagi)</option>
        </select>

        <input id="searchInput" placeholder="Cari nama / kontak / email" />
        <button id="addBtn">Tambah Operator</button>
        <button id="normalizeBtn" class="small">Ubah Semua jadi huruf kecil</button>
        <div class="right flex">
          <button id="exportBtn" class="small">Ekspor CSV</button>
          <input id="importFile" type="file" accept="text/csv" style="display:none" />
          <button id="importBtn" class="small">Impor CSV</button>
        </div>
      </div>

      <table id="dataTable" aria-label="Daftar Operator">
        <thead>
          <tr>
            <th>No</th>
            <th>Kab/Kota</th>
            <th>Nama Operator</th>
            <th>Kontak</th>
            <th>Email</th>
            <th>Area / Catatan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="note">Tip: tekan <strong>Tambah Operator</strong> lalu isi data. Data tersimpan di browser — untuk sinkron ke Google Sheets/Server butuh integrasi tambahan.</div>
    </div>
  </div>

  <!-- Modal sederhana -->
  <div id="modal" style="display:none;position:fixed;inset:0;background:rgba(4,8,18,.5);align-items:center;justify-content:center;padding:20px">
    <div style="background:#fff;border-radius:10px;padding:18px;max-width:520px;width:100%">
      <h3 id="modalTitle">Tambah Operator</h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <select id="m_region"><option>Makassar</option><option>Parepare</option><option>Palopo</option><option>Bone</option><option>Gowa</option><option>Maros</option></select>
        <input id="m_name" placeholder="Nama operator" />
        <input id="m_contact" placeholder="Kontak (telp/WA)" />
        <input id="m_email" placeholder="Email" />
        <input id="m_area" placeholder="Area / Catatan" />
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="cancelModal" style="background:#f3f4f6;color:#111;padding:8px 10px;border-radius:8px">Batal</button>
        <button id="saveModal">Simpan</button>
      </div>
    </div>
  </div>

  <script>
    // LocalStorage key
    const STORAGE_KEY = 'sulsel_operators_v1'

    // Example starter data (editable)
    const starter = [
      {name:'operator a'},
      {name:'operator b'}
    ]

    // DOM refs
    const tbody = document.querySelector('#dataTable tbody')
    const regionFilter = document.getElementById('regionFilter')
    const searchInput = document.getElementById('searchInput')
    const addBtn = document.getElementById('addBtn')
    const modal = document.getElementById('modal')
    const modalTitle = document.getElementById('modalTitle')
    const m_region = document.getElementById('m_region')
    const m_name = document.getElementById('m_name')
    const m_contact = document.getElementById('m_contact')
    const m_email = document.getElementById('m_email')
    const m_area = document.getElementById('m_area')
    const saveModal = document.getElementById('saveModal')
    const cancelModal = document.getElementById('cancelModal')
    const normalizeBtn = document.getElementById('normalizeBtn')
    const exportBtn = document.getElementById('exportBtn')
    const importBtn = document.getElementById('importBtn')
    const importFile = document.getElementById('importFile')

    let operators = load()
    let editIndex = -1

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY)
      if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(starter)); return starter.slice() }
      try{ return JSON.parse(raw)}catch(e){ return [] }
    }

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(operators)); render() }

    function render(){
      const q = searchInput.value.trim().toLowerCase()
      const reg = regionFilter.value
      tbody.innerHTML = ''
      const filtered = operators.filter((o)=>{
        if(reg && o.region !== reg) return false
        if(!q) return true
        return [o.name,o.contact,o.email,o.area].join(' ').toLowerCase().includes(q)
      })
      filtered.forEach((op,i)=>{
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td data-label="No">${i+1}</td>
          <td data-label="Kab/Kota">${escapeHtml(op.region)}</td>
          <td data-label="Nama">${escapeHtml(op.name)}</td>
          <td data-label="Kontak">${escapeHtml(op.contact)}</td>
          <td data-label="Email">${escapeHtml(op.email)}</td>
          <td data-label="Area">${escapeHtml(op.area)}</td>
          <td data-label="Aksi" class="actions">
            <button onclick="editOperator(${i})">Edit</button>
            <button onclick="deleteOperator(${i})" style="background:#ffecec;color:#7a1b1b">Hapus</button>
          </td>`
        tbody.appendChild(tr)
      })
    }

    // helpers
    function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

    // actions
    addBtn.addEventListener('click', ()=>{ openModal(); })
    regionFilter.addEventListener('change', render)
    searchInput.addEventListener('input', render)
    cancelModal.addEventListener('click', ()=>{ closeModal() })

    function openModal(data){
      modal.style.display='flex'
      modalTitle.textContent = data ? 'Edit Operator' : 'Tambah Operator'
      editIndex = data?.index ?? -1
      m_region.value = data?.region ?? m_region.options[0].value
      m_name.value = data?.name ?? ''
      m_contact.value = data?.contact ?? ''
      m_email.value = data?.email ?? ''
      m_area.value = data?.area ?? ''
    }

    function closeModal(){ modal.style.display='none'; editIndex = -1 }

    saveModal.addEventListener('click', ()=>{
      const obj = {region:m_region.value.trim(),name:m_name.value.trim(),contact:m_contact.value.trim(),email:m_email.value.trim(),area:m_area.value.trim()}
      if(!obj.name){ alert('Nama operator diperlukan'); return }
      if(editIndex>=0){ operators[editIndex] = obj } else { operators.push(obj) }
      save()
      closeModal()
    })

    window.editOperator = (i)=>{ openModal({...operators[i], index:i}) }
    window.deleteOperator = (i)=>{ if(confirm('Hapus data ini?')){ operators.splice(i,1); save() } }

    normalizeBtn.addEventListener('click', ()=>{
      if(!confirm('Ubah semua teks menjadi huruf kecil?')) return
      operators = operators.map(o=>({region:o.region.toLowerCase(),name:o.name.toLowerCase(),contact:o.contact.toLowerCase(),email:o.email.toLowerCase(),area:o.area.toLowerCase()}))
      save()
    })

    // CSV export
    exportBtn.addEventListener('click', ()=>{
      const rows = [['region','name','contact','email','area'],...operators.map(o=>[o.region,o.name,o.contact,o.email,o.area])]
      const csv = rows.map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n')
      const blob = new Blob([csv],{type:'text/csv'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a'); a.href=url; a.download='operators_sulsel.csv'; a.click(); URL.revokeObjectURL(url)
    })

    // CSV import (very simple)
    importBtn.addEventListener('click', ()=> importFile.click())
    importFile.addEventListener('change', (e)=>{
      const f = e.target.files[0]
      if(!f) return
      const reader = new FileReader()
      reader.onload = ()=>{
        const text = reader.result
        const lines = text.split(/\r?\n/).filter(Boolean)
        const parsed = lines.slice(1).map(l=>{
          const cols = l.split(',').map(c=>c.replace(/^"|"$/g,'').replace(/""/g,'"'))
          return {region:cols[0]||'',name:cols[1]||'',contact:cols[2]||'',email:cols[3]||'',area:cols[4]||''}
        })
        operators = operators.concat(parsed)
        save()
        importFile.value = ''
      }
      reader.readAsText(f,'utf-8')
    })

    // initial render
    render()

    // allow pressing Escape to close modal
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal() })
  </script>
</body>
</html>
